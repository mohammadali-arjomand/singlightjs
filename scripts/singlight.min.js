var activePage=null,element=null;class Page{token={set(e){localStorage.setItem("singlightApiTokenManager",e)},get:()=>localStorage.getItem("singlightApiTokenManager"),remove(){localStorage.removeItem("singlightApiTokenManager")},check:()=>null!==localStorage.getItem("singlightApiTokenManager")};redirect(e){e=(e="/"!==e.substring(0,1)?"/"+e:e).substring(0,this.root.length)!==this.root?this.root+e:e,window.history.pushState({},"",e),this.singlight.start()}url(e,t){for(let r of this.names)if(r.name==e){let i=r.uri.replace(/(\{.*?\}\/)/g,(e,r)=>t[r.substring(1,r.length-2).trim()]+"/");return this.root+"/"+i.substring(1,i.length)}return null}template(e){return document.getElementById(e).innerHTML}title(e){document.title=e}render(template){let variables,el;template.querySelectorAll("[\\@for]").forEach(e=>{for(let t of this[(variables=e.getAttribute("@for").split(" of "))[1].trim()])(el=document.createElement(e.nodeName)).innerHTML=e.innerHTML,el=e.parentNode.insertBefore(el,e),this[variables[0].trim()]=t,this.render(el);e.parentNode.removeChild(e)}),template.innerHTML=template.innerHTML.replace(/(\{\{.*?\}\})/g,(e,t)=>{let r,i=(t=t.substring(2,t.length-2)).split("."),n=this[i[0].trim()];for(delete i[0],r=1;r<i.length;r++)n=n[i[r].trim()];return"object"==typeof n?n.value:n}),template.querySelectorAll("[\\@if]").forEach(e=>{eval(e.getAttribute("@if"))?e.removeAttribute("@if"):e.parentNode.removeChild(e)}),template.querySelectorAll("[\\@display]").forEach(e=>{eval(e.getAttribute("@display"))||(e.style.display="none"),e.removeAttribute("@display")});let event;template.querySelectorAll("[\\@event]").forEach(e=>{event=e.getAttribute("@event").split(":"),e.addEventListener(event[0].trim(),e=>{this[event[1].trim()](e)}),e.removeAttribute("@event")});let route,name,params,passedParams={};template.querySelectorAll("[\\@route]").forEach(e=>{if("_"===(route=e.getAttribute("@route")).trim().substring(0,1)){for(let t in name=(name=route.split(":")[0]).substring(1,name.length),params=(params=route.split(":")[1]).split(","))passedParams[params[t].split("=")[0]]=params[t].split("=")[1];e.addEventListener("click",()=>{this.redirect(this.url(name,passedParams))})}else e.addEventListener("click",()=>{this.redirect(route)});e.removeAttribute("@route")})}}class Reactive{constructor(e){this.value=e}get value(){return this._value}set value(e){this._value=e,null!==activePage&&(element.innerHTML=activePage.template(),activePage.render(element))}}class Router{constructor(){this.routes=[],this.names=[]}setRoot(e){e="/"===(e="/"!==e.substring(0,1)?"/"+e:e).substring(e.length-1,e.length)?e.substring(0,e.length-1):e,this.root=e}addRoute(e,t,r=null,i=null){let n=(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(/(\{.*?\}\/)/g,"(.+?\\/)");this.routes.push({uri:e,page:t,regex:RegExp(`^${n}`,"g"),accessor:i}),null!==r&&this.names.push({name:r,uri:e})}addRouteError(e,t){this.notfound=404==e?t:this.notfound,this.forbidden=403==e?t:this.forbidden}addRouteGroup(e,t){e="/"!==e.substring(0,1)?"/"+e:e;let r=t(new Router),i=void 0!==r?r.routes:[],n=void 0!==r?r.names:[];for(let s in i){let l=i[s].regex.toString();"/"!==i[s].uri.substring(0,1)?(i[s].uri=`${e}/${i[s].uri}`,i[s].regex=RegExp(`${e}\\/${l.substring(2,l.length-2)}`,"g")):(i[s].uri=`${e}${i[s].uri}`,i[s].regex=RegExp(`${e}${l.substring(2,l.length-2)}`,"g")),void 0!==n[s]&&("/"!==n[s].uri.substring(0,1)?n[s].uri=`${e}/${n[s].uri}`:n[s].uri=`${e}${n[s].uri}`),this.routes.push(i[s]),void 0!==n[s]&&this.names.push(n[s])}}isMatch(e){for(let t of this.routes)if(""===(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(t.regex,"")){let r={},i=e.substring(1,e.length).match(RegExp("(.+?\\/)","g")),n=t.uri.substring(1,t.uri.length).match(RegExp("(.+?\\/)","g"));for(let s in n)r[n[s].substring(1,n[s].length-2).trim()]=i[s].substring(0,i[s].length-1);return{route:t,variables:r}}return null}}class Singlight{router(e){this.router=e}mount(e){element=document.querySelector(e)}start(){let e=window.location.pathname.substring(this.router.root.length,window.location.pathname.length),t=this.router.isMatch(e);null!==t?null!==t.route.accessor&&!1===t.route.accessor()?void 0!==this.router.forbidden?(activePage=new this.router.forbidden,element.innerHTML=activePage.template(),activePage.render(element)):element.innerHTML="<h1>403 Forbidden</h1>":((activePage=new t.route.page).route=t.variables,activePage.names=this.router.names,activePage.root=this.router.root,activePage.singlight=this,void 0!==activePage.setup&&activePage.setup(),element.innerHTML=activePage.template(),activePage.render(element)):void 0!==this.router.notfound?(activePage=new this.router.notfound,element.innerHTML=activePage.template(),activePage.render(element)):element.innerHTML="<h1>404 Not Found</h1>"}}export{Page,Reactive,Router,Singlight}