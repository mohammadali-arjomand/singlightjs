let activePage=null,element=null;class Page{token={set(e){localStorage.setItem("token",e)},get:()=>localStorage.getItem("token"),remove(){localStorage.removeItem("token")},check:()=>null!==localStorage.getItem("token")};redirect(e){e=(e="/"!==e.substring(0,1)?"/"+e:e).substring(0,this.root.length)!==this.root?this.root+e:e,window.history.pushState({},"",e),this.singlight.start()}back(){window.history.back(),setTimeout(()=>this.singlight.start(),5)}url(e,t){for(let r of this.names)if(r.name===e){let i=r.uri.replace(/(\{.*?\}\/)/g,(e,r)=>t[r.substring(1,r.length-2).trim()]+"/");return this.root+"/"+i.substring(1,i.length)}return null}load(e){return document.getElementById(e).innerHTML}refresh(){element.innerHTML=activePage.template(),activePage.render(element)}title(e){document.title=e}style(e){let t=document.querySelector("link[rel=stylesheet]");null===t&&((t=document.createElement("link")).rel="stylesheet",document.head.appendChild(t)),t.href=`./Styles/${e}.css`}elementor(e){let t=document.createElement(e.name);if(void 0!==e.attributes)for(let r in e.attributes)t.setAttribute(r,e.attributes[r]);if(void 0!==e.text&&(t.innerHTML=e.text),void 0!==e.children)for(let i in e.children)t.appendChild(this.elementor(e.children[i]));return t}render(template){if(template.querySelectorAll("[sl-for]").forEach(e=>{let variables=e.getAttribute("sl-for").split(" of ");for(let i in eval(variables[1].trim())){let el=document.createElement(e.nodeName);for(let attr of e.getAttributeNames())"sl-for"!==attr&&el.setAttribute(attr,e.getAttribute(attr));if(el.innerHTML=e.innerHTML,el=e.parentNode.insertBefore(el,e),variables[0].includes(":")){let key=variables[0].split(":")[0].trim(),value=variables[0].split(":")[1].trim();this[key]=i,this[value]=this[variables[1].trim()][i]}else this[variables[0].trim()]=eval(variables[1].trim())[i];el.innerHTML=el.innerHTML.replace(/(\{\{.*?\}\})/g,(m,find)=>eval(find.substring(2,find.length-2).trim()))}e.parentNode.removeChild(e)}),template.querySelectorAll("[sl-template]").forEach(e=>{e.innerHTML=this.load(e.getAttribute("sl-template"))}),template.innerHTML=template.innerHTML.replace(/(\{\{.*?\}\})/g,(m,find)=>eval(find.substring(2,find.length-2).trim())),template.querySelectorAll("[sl-if]").forEach(e=>{eval(e.getAttribute("sl-if"))?e.removeAttribute("sl-if"):e.parentNode.removeChild(e)}),template.querySelectorAll("[sl-display]").forEach(e=>{eval(e.getAttribute("sl-display"))||(e.style.display="none"),e.removeAttribute("sl-display")}),template.querySelectorAll("[sl-on]").forEach(e=>{let event=e.getAttribute("sl-on").split(":");e.addEventListener(event[0].trim(),$=>eval(event[1].trim())),e.removeAttribute("sl-on")}),template.querySelectorAll("[sl-back]").forEach(e=>{e.addEventListener("click",()=>this.back()),e.removeAttribute("sl-back")}),template.querySelectorAll("[sl-route]").forEach(e=>{let t=e.getAttribute("sl-route");if("_"===t.trim().substring(0,1)){let r=t.split(":")[0];r=r.substring(1,r.length);let i={};if(t.includes(":")){let l=t.split(":")[1];for(let s in l=l.split(","))i[l[s].split("=")[0]]=l[s].split("=")[1]}e.setAttribute("sl-goto",this.url(r,i))}else e.setAttribute("sl-goto",t);e.addEventListener("click",e=>{this.redirect(e.target.getAttribute("sl-goto"))}),e.removeAttribute("sl-route")}),template.querySelectorAll("[sl-style]").forEach(e=>{let styles=eval(e.getAttribute("sl-style"));for(let style in styles)e.style[style]=styles[style]}),void 0!==this.components)for(let componentName in this.components)template.querySelectorAll("sl-"+componentName.replace(/Component/i,"")).forEach(e=>{let t=document.createElement("div"),r={};for(let i of e.getAttributeNames())r[i]=e.getAttribute(i);e.querySelectorAll("sl-slot[name]").forEach(e=>{r[e.getAttribute("name")]=e.innerHTML,e.parentNode.removeChild(e)}),r.slot=e.innerHTML,t.innerHTML=this.components[componentName].apply(r),e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e)})}}class Router{root="";constructor(){this.routes=[],this.names=[]}setRoot(e){e="/"===(e="/"!==e.substring(0,1)?"/"+e:e).substring(e.length-1,e.length)?e.substring(0,e.length-1):e,this.root=e}addRoute(e,t,r=null,i=null){let l=(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(/(\{.*?\}\/)/g,"(.+?\\/)");this.routes.push({uri:e,page:t,regex:RegExp(`^${l}`,"g"),accessor:i}),null!==r&&this.names.push({name:r,uri:e})}addRouteError(e,t){this.notfound=404==e?t:this.notfound,this.forbidden=403==e?t:this.forbidden}addRouteGroup(e,t){e="/"!==e.substring(0,1)?"/"+e:e;let r=t(new Router),i=void 0!==r?r.routes:[],l=void 0!==r?r.names:[];for(let s in i){let n=i[s].regex.toString();"/"!==i[s].uri.substring(0,1)?(i[s].uri=`${e}/${i[s].uri}`,i[s].regex=RegExp(`${e}\\/${n.substring(2,n.length-2)}`,"g")):(i[s].uri=`${e}${i[s].uri}`,i[s].regex=RegExp(`${e}${n.substring(2,n.length-2)}`,"g")),void 0!==l[s]&&("/"!==l[s].uri.substring(0,1)?l[s].uri=`${e}/${l[s].uri}`:l[s].uri=`${e}${l[s].uri}`),this.routes.push(i[s]),void 0!==l[s]&&this.names.push(l[s])}}isMatch(e){for(let t of this.routes)if(""===(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(t.regex,"")){let r={},i=e.substring(1,e.length).match(RegExp("(.+?\\/)","g")),l=t.uri.substring(1,t.uri.length).match(RegExp("(.+?\\/)","g"));for(let s in l)r[l[s].substring(1,l[s].length-2).trim()]=i[s].substring(0,i[s].length-1);return{route:t,variables:r}}return null}}class Singlight{router(e){this.router=e}hooks(e){this.hooks=e}mount(e){element=document.querySelector(e)}start(){void 0!==this.hooks.beforeMount&&this.hooks.beforeMount();let e=window.location.pathname.substring(this.router.root.length,window.location.pathname.length),t=this.router.isMatch(e);null!==t?null!==t.route.accessor&&!1===t.route.accessor()?void 0!==this.router.forbidden?(activePage=new this.router.forbidden,element.innerHTML=activePage.template(),activePage.render(element)):element.innerHTML="<h1>403 Forbidden</h1>":((activePage=new t.route.page).route=t.variables,activePage.names=this.router.names,activePage.root=this.router.root,activePage.singlight=this,void 0!==activePage.setup&&activePage.setup(),element.innerHTML=activePage.template(),activePage.render(element)):void 0!==this.router.notfound?(activePage=new this.router.notfound,element.innerHTML=activePage.template(),activePage.render(element)):element.innerHTML="<h1>404 Not Found</h1>",void 0!==this.hooks.afterMount&&this.hooks.afterMount()}}export default Singlight;export{Page,Router};