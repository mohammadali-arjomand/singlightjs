var activePage=null,element=null;class Page{token={set(e){localStorage.setItem("singlightApiTokenManager",e)},get:()=>localStorage.getItem("singlightApiTokenManager"),remove(){localStorage.removeItem("singlightApiTokenManager")},check:()=>null!==localStorage.getItem("singlightApiTokenManager")};redirect(e){e=(e="/"!==e.substring(0,1)?"/"+e:e).substring(0,this.root.length)!==this.root?this.root+e:e,window.history.pushState({},"",e),this.singlight.start()}back(){window.history.back(),setTimeout(()=>this.singlight.start(),5)}url(e,t){for(let r of this.names)if(r.name==e){let i=r.uri.replace(/(\{.*?\}\/)/g,(e,r)=>t[r.substring(1,r.length-2).trim()]+"/");return this.root+"/"+i.substring(1,i.length)}return null}load(e){return document.getElementById(e).innerHTML}refresh(){element.innerHTML=activePage.template(),activePage.render(element)}title(e){document.title=e}elementor(e){let t=document.createElement(e.name);if(void 0!==e.attributes)for(let r in e.attributes)t.setAttribute(r,e.attributes[r]);if(void 0!==e.text&&(t.innerHTML=e.text),void 0!==e.children)for(let i in e.children)t.appendChild(this.elementor(e.children[i]));return t}render(template){function replaceVariables(e,t){e.innerHTML=e.innerHTML.replace(/(\{\{.*?\}\})/g,(e,r)=>{let i,n=(r=r.substring(2,r.length-2)).split("."),l=t[n[0].trim()];for(delete n[0],i=1;i<n.length;i++)l=l[n[i].trim()];return"object"==typeof l?l.value:l})}let variables,el,vars;template.querySelectorAll("[\\@for]").forEach(e=>{for(let t in!0===this[(variables=e.getAttribute("@for").split(" of "))[1].trim()].iAmReactive?this[variables[1].trim()].value:this[variables[1].trim()])(el=document.createElement(e.nodeName)).innerHTML=e.innerHTML,el=e.parentNode.insertBefore(el,e),vars=this,vars[variables[0].trim()]=!0===this[variables[1].trim()].iAmReactive?this[variables[1].trim()].value[t]:this[variables[1].trim()][t],replaceVariables(el,vars);e.parentNode.removeChild(e)}),template.querySelectorAll("[\\@template]").forEach(e=>{e.innerHTML=this.load(e.getAttribute("@template"))}),replaceVariables(template,this),template.querySelectorAll("[\\@if]").forEach(e=>{eval(e.getAttribute("@if"))?e.removeAttribute("@if"):e.parentNode.removeChild(e)}),template.querySelectorAll("[\\@display]").forEach(e=>{eval(e.getAttribute("@display"))||(e.style.display="none"),e.removeAttribute("@display")});let event;template.querySelectorAll("[\\@event]").forEach(e=>{event=e.getAttribute("@event").split(":"),e.addEventListener(event[0].trim(),e=>this[event[1].trim()](e)),e.removeAttribute("@event")}),template.querySelectorAll("[\\@back]").forEach(e=>{e.addEventListener("click",()=>this.back()),e.removeAttribute("@back")});let route,name,params,passedParams={};template.querySelectorAll("[\\@route]").forEach(e=>{if("_"===(route=e.getAttribute("@route")).trim().substring(0,1)){if(name=(name=route.split(":")[0]).substring(1,name.length),route.includes(":"))for(let t in params=(params=route.split(":")[1]).split(","))passedParams[params[t].split("=")[0]]=params[t].split("=")[1];e.setAttribute("sl-goto",this.url(name,passedParams))}else e.setAttribute("sl-goto",route);e.addEventListener("click",e=>{this.redirect(e.target.getAttribute("sl-goto"))}),e.removeAttribute("@route")})}}class Reactive{iAmReactive=!0;constructor(e){this.value=e}get value(){return this._value}set value(e){this._value=e,null!==activePage&&(element.innerHTML=activePage.template(),activePage.render(element))}}class Router{root="";constructor(){this.routes=[],this.names=[]}setRoot(e){e="/"===(e="/"!==e.substring(0,1)?"/"+e:e).substring(e.length-1,e.length)?e.substring(0,e.length-1):e,this.root=e}addRoute(e,t,r=null,i=null){let n=(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(/(\{.*?\}\/)/g,"(.+?\\/)");this.routes.push({uri:e,page:t,regex:RegExp(`^${n}`,"g"),accessor:i}),null!==r&&this.names.push({name:r,uri:e})}addRouteError(e,t){this.notfound=404==e?t:this.notfound,this.forbidden=403==e?t:this.forbidden}addRouteGroup(e,t){e="/"!==e.substring(0,1)?"/"+e:e;let r=t(new Router),i=void 0!==r?r.routes:[],n=void 0!==r?r.names:[];for(let l in i){let s=i[l].regex.toString();"/"!==i[l].uri.substring(0,1)?(i[l].uri=`${e}/${i[l].uri}`,i[l].regex=RegExp(`${e}\\/${s.substring(2,s.length-2)}`,"g")):(i[l].uri=`${e}${i[l].uri}`,i[l].regex=RegExp(`${e}${s.substring(2,s.length-2)}`,"g")),void 0!==n[l]&&("/"!==n[l].uri.substring(0,1)?n[l].uri=`${e}/${n[l].uri}`:n[l].uri=`${e}${n[l].uri}`),this.routes.push(i[l]),void 0!==n[l]&&this.names.push(n[l])}}isMatch(e){for(let t of this.routes)if(""===(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(t.regex,"")){let r={},i=e.substring(1,e.length).match(RegExp("(.+?\\/)","g")),n=t.uri.substring(1,t.uri.length).match(RegExp("(.+?\\/)","g"));for(let l in n)r[n[l].substring(1,n[l].length-2).trim()]=i[l].substring(0,i[l].length-1);return{route:t,variables:r}}return null}}class Singlight{router(e){this.router=e}mount(e){element=document.querySelector(e)}start(){let e=window.location.pathname.substring(this.router.root.length,window.location.pathname.length),t=this.router.isMatch(e);null!==t?null!==t.route.accessor&&!1===t.route.accessor()?void 0!==this.router.forbidden?(activePage=new this.router.forbidden,element.innerHTML=activePage.template(),activePage.render(element)):element.innerHTML="<h1>403 Forbidden</h1>":((activePage=new t.route.page).route=t.variables,activePage.names=this.router.names,activePage.root=this.router.root,activePage.singlight=this,void 0!==activePage.setup&&activePage.setup(),element.innerHTML=activePage.template(),activePage.render(element)):void 0!==this.router.notfound?(activePage=new this.router.notfound,element.innerHTML=activePage.template(),activePage.render(element)):element.innerHTML="<h1>404 Not Found</h1>"}}export{Page,Reactive,Router,Singlight}