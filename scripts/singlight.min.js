let activePage,element;class Page{token={set(e){localStorage.setItem("token",e)},get:()=>localStorage.getItem("token"),remove(){localStorage.removeItem("token")},check:()=>null!==localStorage.getItem("token")};redirect(e){e=(e="/"!==e.substring(0,1)?"/"+e:e).substring(0,this.root.length)!==this.root?this.root+e:e,window.history.pushState({},"",e),this.singlight.start()}back(){window.history.back(),setTimeout(()=>this.singlight.start(),5)}url(e,t){for(let r of this.names)if(r.name===e){let i=r.uri.replace(/(\{.*?\}\/)/g,(e,r)=>t[r.substring(1,r.length-2).trim()]+"/");return this.root+"/"+i.substring(1,i.length)}return null}refresh(){this.element.innerHTML=this.template(),this.render(this.element)}title(e){document.title=e}style(e){let t=document.querySelector("link[rel=stylesheet]");null===t&&((t=document.createElement("link")).rel="stylesheet",document.head.appendChild(t)),t.href=`./Styles/${e}.css`}elementor(e){let t=document.createElement(e.name);if(void 0!==e.attributes)for(let r in e.attributes)t.setAttribute(r,e.attributes[r]);if(void 0!==e.text&&(t.innerHTML=e.text),void 0!==e.children)for(let i in e.children)t.appendChild(this.elementor(e.children[i]));return t}render(template){template.querySelectorAll("[sl-for]").forEach(e=>{let variables=e.getAttribute("sl-for").split(" of ");for(let i in eval(variables[1].trim())){let el=document.createElement(e.nodeName);for(let attr of e.getAttributeNames())"sl-for"!==attr&&el.setAttribute(attr,e.getAttribute(attr));if(el.innerHTML=e.innerHTML,el=e.parentNode.insertBefore(el,e),variables[0].includes(":")){let key=variables[0].split(":")[0].trim(),value=variables[0].split(":")[1].trim();this[key]=i,this[value]=this[variables[1].trim()][i]}else this[variables[0].trim()]=eval(variables[1].trim())[i];el.innerHTML=el.innerHTML.replace(/(\{\{.*?\}\})/g,(m,find)=>eval(find.substring(2,find.length-2).trim()))}e.parentNode.removeChild(e)}),template.innerHTML=template.innerHTML.replace(/(\{\{.*?\}\})/g,(m,find)=>eval(find.substring(2,find.length-2).trim()));let whileForIf=(el,remove)=>{let removes=[];for(;null!==el;)if(null!==el.getAttribute("sl-elif"))remove?removes.push(el):eval(el.getAttribute("sl-elif"))?(el.removeAttribute("sl-elif"),remove=!0):removes.push(el),el=el.nextElementSibling;else if(null!==el.getAttribute("sl-else")){remove?removes.push(el):el.removeAttribute("sl-else");break}else break;for(let rm of removes)rm.remove()};if(template.querySelectorAll("[sl-if]").forEach(e=>{eval(e.getAttribute("sl-if"))?(e.removeAttribute("sl-if"),whileForIf(e.nextElementSibling,!0)):(null!==e.nextElementSibling&&null!==e.nextElementSibling.getAttribute("sl-else")?e.nextElementSibling.removeAttribute("sl-else"):whileForIf(e.nextElementSibling,!1),e.parentNode.removeChild(e))}),template.querySelectorAll("[sl-display]").forEach(e=>{eval(e.getAttribute("sl-display"))||(e.style.display="none"),e.removeAttribute("sl-display")}),template.querySelectorAll("[sl-on]").forEach(e=>{let event=e.getAttribute("sl-on").split(":");e.addEventListener(event[0].trim(),$=>eval(event[1].trim())),e.removeAttribute("sl-on")}),template.querySelectorAll("[sl-back]").forEach(e=>{e.addEventListener("click",()=>this.back()),e.removeAttribute("sl-back")}),template.querySelectorAll("[sl-route]").forEach(e=>{let t=e.getAttribute("sl-route");if("_"===t.trim().substring(0,1)){let r=t.split(":")[0];r=r.substring(1,r.length);let i={};if(t.includes(":")){let s=t.split(":")[1];for(let l in s=s.split(","))i[s[l].split("=")[0]]=s[l].split("=")[1]}e.setAttribute("sl-goto",this.url(r,i))}else e.setAttribute("sl-goto",t);e.addEventListener("click",e=>{this.redirect(e.target.getAttribute("sl-goto"))}),e.removeAttribute("sl-route")}),template.querySelectorAll("[sl-style]").forEach(e=>{let styles=eval(e.getAttribute("sl-style"));for(let style in styles)e.style[style]=styles[style]}),void 0!==this.components)for(let componentName in this.components)template.querySelectorAll("sl-"+componentName.replace(/Component/i,"")).forEach(e=>{let componentDiv=document.createElement("div"),componentAttrs={};for(let componentAttr of e.getAttributeNames())":"===componentAttr.substring(0,1)?componentAttrs[componentAttr.replace(":","")]=eval(e.getAttribute(componentAttr)):componentAttrs[componentAttr]=e.getAttribute(componentAttr);e.querySelectorAll("sl-slot[name]").forEach(e=>{componentAttrs[e.getAttribute("name")]=e.innerHTML,e.parentNode.removeChild(e)}),componentAttrs.slot=e.innerHTML,componentDiv.innerHTML=this.components[componentName].apply(componentAttrs),e.parentNode.insertBefore(componentDiv,e),e.parentNode.removeChild(e)})}}class Router{root="";constructor(){this.routes=[],this.names=[]}setRoot(e){e="/"===(e="/"!==e.substring(0,1)?"/"+e:e).substring(e.length-1,e.length)?e.substring(0,e.length-1):e,this.root=e}addRoute(e,t,r=null,i=null){let s=(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(/(\{.*?\}\/)/g,"(.+?\\/)");this.routes.push({uri:e,page:t,regex:RegExp(`^${s}`,"g"),accessor:i}),null!==r&&this.names.push({name:r,uri:e})}addRouteError(e,t){this.notfound=404==e?t:this.notfound,this.forbidden=403==e?t:this.forbidden}addRouteGroup(e,t){e="/"!==e.substring(0,1)?"/"+e:e;let r=t(new Router),i=void 0!==r?r.routes:[],s=void 0!==r?r.names:[];for(let l in i){let n=i[l].regex.toString();"/"!==i[l].uri.substring(0,1)?(i[l].uri=`${e}/${i[l].uri}`,i[l].regex=RegExp(`${e}\\/${n.substring(2,n.length-2)}`,"g")):(i[l].uri=`${e}${i[l].uri}`,i[l].regex=RegExp(`${e}${n.substring(2,n.length-2)}`,"g")),void 0!==s[l]&&("/"!==s[l].uri.substring(0,1)?s[l].uri=`${e}/${s[l].uri}`:s[l].uri=`${e}${s[l].uri}`),this.routes.push(i[l]),void 0!==s[l]&&this.names.push(s[l])}}isMatch(e){for(let t of this.routes)if(""===(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(t.regex,"")){let r={},i=e.substring(1,e.length).match(RegExp("(.+?\\/)","g")),s=t.uri.substring(1,t.uri.length).match(RegExp("(.+?\\/)","g"));for(let l in s)r[s[l].substring(1,s[l].length-2).trim()]=i[l].substring(0,i[l].length-1);return{route:t,variables:r}}return null}}class Singlight{router(e){this.router=e}hooks(e){this.hooks=e}accessors(e){this.accessors=e}mount(e){element=document.querySelector(e)}start(){void 0!==this.hooks.beforeMount&&this.hooks.beforeMount();let e=window.location.pathname.substring(this.router.root.length,window.location.pathname.length),t=this.router.isMatch(e),r=e=>{(activePage=new e).route=t.variables,activePage.names=this.router.names,activePage.root=this.router.root,activePage.singlight=this,activePage.element=element,void 0!==activePage.setup&&activePage.setup(),window.addEventListener("popstate",e=>{this.start()}),element.innerHTML=activePage.template(),activePage.render(element)};if(null!==t){let i=t.route.accessor;if("string"==typeof i&&(i=i.split(",")),null!==i&&"object"==typeof i){let s=[];for(let l of i)for(let n in this.accessors)l===n.replace(/Accessor/i,"")&&s.push(this.accessors[n]);i=()=>{for(let e of s)if(!1===e())return!1;return!0}}null!==i&&!1===i()?void 0!==this.router.forbidden?r(this.router.forbidden):element.innerHTML="<h1>403 Forbidden</h1>":r(t.route.page)}else void 0!==this.router.notfound?r(this.router.notfound):element.innerHTML="<h1>404 Not Found</h1>";void 0!==this.hooks.afterMount&&this.hooks.afterMount()}}export default Singlight;export{Page,Router};