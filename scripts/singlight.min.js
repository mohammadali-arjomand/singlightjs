let activePage=null,element=null;class Page{token={set(e){localStorage.setItem("token",e)},get:()=>localStorage.getItem("token"),remove(){localStorage.removeItem("token")},check:()=>null!==localStorage.getItem("token")};redirect(e){e=(e="/"!==e.substring(0,1)?"/"+e:e).substring(0,this.root.length)!==this.root?this.root+e:e,window.history.pushState({},"",e),this.singlight.start()}back(){window.history.back(),setTimeout(()=>this.singlight.start(),5)}url(e,t){for(let r of this.names)if(r.name===e){let i=r.uri.replace(/(\{.*?\}\/)/g,(e,r)=>t[r.substring(1,r.length-2).trim()]+"/");return this.root+"/"+i.substring(1,i.length)}return null}load(e){return document.getElementById(e).innerHTML}refresh(){element.innerHTML=activePage.template(),activePage.render(element)}title(e){document.title=e}elementor(e){let t=document.createElement(e.name);if(void 0!==e.attributes)for(let r in e.attributes)t.setAttribute(r,e.attributes[r]);if(void 0!==e.text&&(t.innerHTML=e.text),void 0!==e.children)for(let i in e.children)t.appendChild(this.elementor(e.children[i]));return t}render(template){let variables,el,attr,key,value;template.querySelectorAll("[sl-for]").forEach(e=>{for(let i in eval((variables=e.getAttribute("sl-for").split(" of "))[1].trim())){for(attr of(el=document.createElement(e.nodeName),e.getAttributeNames()))"sl-for"!==attr&&el.setAttribute(attr,e.getAttribute(attr));el.innerHTML=e.innerHTML,el=e.parentNode.insertBefore(el,e),variables[0].includes(":")?(key=variables[0].split(":")[0].trim(),value=variables[0].split(":")[1].trim(),this[key]=i,this[value]=this[variables[1].trim()][i]):this[variables[0].trim()]=eval(variables[1].trim())[i],el.innerHTML=el.innerHTML.replace(/(\{\{.*?\}\})/g,(m,find)=>eval(find.substring(2,find.length-2).trim()))}e.parentNode.removeChild(e)}),template.querySelectorAll("[sl-template]").forEach(e=>{e.innerHTML=this.load(e.getAttribute("sl-template"))}),template.innerHTML=template.innerHTML.replace(/(\{\{.*?\}\})/g,(m,find)=>eval(find.substring(2,find.length-2).trim())),template.querySelectorAll("[sl-if]").forEach(e=>{eval(e.getAttribute("sl-if"))?e.removeAttribute("sl-if"):e.parentNode.removeChild(e)}),template.querySelectorAll("[sl-display]").forEach(e=>{eval(e.getAttribute("sl-display"))||(e.style.display="none"),e.removeAttribute("sl-display")});let event;template.querySelectorAll("[sl-event]").forEach(e=>{event=e.getAttribute("sl-event").split(":"),e.addEventListener(event[0].trim(),e=>this[event[1].trim()](e)),e.removeAttribute("sl-event")}),template.querySelectorAll("[sl-back]").forEach(e=>{e.addEventListener("click",()=>this.back()),e.removeAttribute("sl-back")});let route,name,params,passedParams={};template.querySelectorAll("[sl-route]").forEach(e=>{if("_"===(route=e.getAttribute("sl-route")).trim().substring(0,1)){if(name=(name=route.split(":")[0]).substring(1,name.length),route.includes(":"))for(let t in params=(params=route.split(":")[1]).split(","))passedParams[params[t].split("=")[0]]=params[t].split("=")[1];e.setAttribute("sl-goto",this.url(name,passedParams))}else e.setAttribute("sl-goto",route);e.addEventListener("click",e=>{this.redirect(e.target.getAttribute("sl-goto"))}),e.removeAttribute("sl-route")});let componentDiv,componentAttrs={},componentAttr;if(void 0!==this.components)for(let componentName in this.components)template.querySelectorAll("x-"+componentName).forEach(e=>{for(componentAttr of(componentDiv=document.createElement("div"),e.getAttributeNames()))componentAttrs[componentAttr]=e.getAttribute(componentAttr);e.querySelectorAll("x-slot[name]").forEach(e=>{componentAttrs[e.getAttribute("name")]=e.innerHTML,e.parentNode.removeChild(e)}),componentAttrs.slot=e.innerHTML,componentDiv.innerHTML=this.components[componentName].apply(componentAttrs),e.parentNode.insertBefore(componentDiv,e),e.parentNode.removeChild(e)})}}class Router{root="";constructor(){this.routes=[],this.names=[]}setRoot(e){e="/"===(e="/"!==e.substring(0,1)?"/"+e:e).substring(e.length-1,e.length)?e.substring(0,e.length-1):e,this.root=e}addRoute(e,t,r=null,i=null){let n=(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(/(\{.*?\}\/)/g,"(.+?\\/)");this.routes.push({uri:e,page:t,regex:RegExp(`^${n}`,"g"),accessor:i}),null!==r&&this.names.push({name:r,uri:e})}addRouteError(e,t){this.notfound=404==e?t:this.notfound,this.forbidden=403==e?t:this.forbidden}addRouteGroup(e,t){e="/"!==e.substring(0,1)?"/"+e:e;let r=t(new Router),i=void 0!==r?r.routes:[],n=void 0!==r?r.names:[];for(let s in i){let o=i[s].regex.toString();"/"!==i[s].uri.substring(0,1)?(i[s].uri=`${e}/${i[s].uri}`,i[s].regex=RegExp(`${e}\\/${o.substring(2,o.length-2)}`,"g")):(i[s].uri=`${e}${i[s].uri}`,i[s].regex=RegExp(`${e}${o.substring(2,o.length-2)}`,"g")),void 0!==n[s]&&("/"!==n[s].uri.substring(0,1)?n[s].uri=`${e}/${n[s].uri}`:n[s].uri=`${e}${n[s].uri}`),this.routes.push(i[s]),void 0!==n[s]&&this.names.push(n[s])}}isMatch(e){for(let t of this.routes)if(""===(e="/"!==e.substring(e.length-1,e.length)?e+"/":e).replace(t.regex,"")){let r={},i=e.substring(1,e.length).match(RegExp("(.+?\\/)","g")),n=t.uri.substring(1,t.uri.length).match(RegExp("(.+?\\/)","g"));for(let s in n)r[n[s].substring(1,n[s].length-2).trim()]=i[s].substring(0,i[s].length-1);return{route:t,variables:r}}return null}}class Singlight{router(e){this.router=e}hooks(e){this.hooks=e}mount(e){element=document.querySelector(e)}start(){void 0!==this.hooks.beforeMount&&this.hooks.beforeMount();let e=window.location.pathname.substring(this.router.root.length,window.location.pathname.length),t=this.router.isMatch(e);null!==t?null!==t.route.accessor&&!1===t.route.accessor()?void 0!==this.router.forbidden?(activePage=new this.router.forbidden,element.innerHTML=activePage.template(),activePage.render(element)):element.innerHTML="<h1>403 Forbidden</h1>":((activePage=new t.route.page).route=t.variables,activePage.names=this.router.names,activePage.root=this.router.root,activePage.singlight=this,void 0!==activePage.setup&&activePage.setup(),element.innerHTML=activePage.template(),activePage.render(element)):void 0!==this.router.notfound?(activePage=new this.router.notfound,element.innerHTML=activePage.template(),activePage.render(element)):element.innerHTML="<h1>404 Not Found</h1>",void 0!==this.hooks.afterMount&&this.hooks.afterMount()}}export default Singlight;export{Page,Router};